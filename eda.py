# -*- coding: utf-8 -*-
"""Google Brain-Ventilator Pressure_EDA.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1jw38h7a_VR3SiRx9gYivWNS4w8d5Um1U
"""

import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt

import warnings
warnings.filterwarnings('ignore')

train=pd.read_csv('train.csv')
test=pd.read_csv('test.csv')

train.info()

test.info()

train.isna().sum()

test.isna().sum()

"""+ there is no NaN in train and test"""

train.describe()

test.describe()

"""+ both train and test have close mean, std, min and max"""

sns.distplot(train['pressure'])

sns.boxplot(train['pressure'])

sns.scatterplot(train['time_step'], train['pressure'])

from scipy import stats

z = np.abs(stats.zscore(train['pressure']))
idx=np.where(z > 3)
len(train.iloc[idx])

from random import sample
breath_id_train=list(train['breath_id'].unique())
L=sample(breath_id_train, 20)

def pressure_distplots():
    sns.set_style('whitegrid')
    plt.figure()
    fig, ax = plt.subplots(5,4,figsize=(14,14))
    plt.subplots_adjust(left=0.1,
                    bottom=0.1, 
                    right=0.9, 
                    top=0.9, 
                    wspace=0.4, 
                    hspace=0.4)
    
    for i in range(20):
      plt.subplot(5,4,i+1)
      df=train[train['breath_id']==L[i]]
      sns.distplot(df['pressure'])
      plt.title('breath_id={}'.format(L[i]), fontsize=9)

pressure_distplots()

def pressure_time_step():
  sns.set_style('whitegrid')
  plt.figure()
  fig, ax = plt.subplots(5,4,figsize=(14,14))
  plt.subplots_adjust(left=0.1,
                    bottom=0.1, 
                    right=0.9, 
                    top=1, 
                    wspace=0.4, 
                    hspace=0.4)
  for i in range(20):
      plt.subplot(5,4,i+1)
      df=train[train['breath_id']==L[i]]
      plt.plot(df['time_step'],df['pressure'])
      plt.title('breath_id={}'.format(L[i]), fontsize=12) 
      plt.xlabel('Time', fontsize=8) 
      plt.ylabel('Pressure', fontsize=8)

pressure_time_step()

sns.set_style('whitegrid')
plt.figure(figsize=(5,5))
for i in L:
        df=train[train['breath_id']==i]
        sns.relplot(data=df, y='pressure', x='time_step', hue='u_out')
        plt.title('breath_id={}'.format(i), fontsize=9)

mean_pressure=train.groupby('breath_id')['pressure'].mean().to_frame().reset_index().rename({'pressure':'mean_breath_pressure'}, axis=1)
sns.distplot(mean_pressure['mean_breath_pressure'])

train['C'].unique()

test['C'].unique()

mean_pressure_C=train.groupby(['C'])['pressure'].mean().to_frame().reset_index().rename({'pressure':'mean_breath_pressure'}, axis=1)
sns.scatterplot(mean_pressure_C['C'],mean_pressure_C['mean_breath_pressure'])

train['R'].unique()

test['R'].unique()

mean_pressure_R=train.groupby(['R'])['pressure'].mean().to_frame().reset_index().rename({'pressure':'mean_breath_pressure'}, axis=1)
sns.scatterplot(mean_pressure_R['R'],mean_pressure_R['mean_breath_pressure'])

max_pressure=train.groupby('breath_id')['pressure'].max().to_frame().reset_index().rename({'pressure':'max_breath_pressure'}, axis=1)
sns.distplot(max_pressure['max_breath_pressure'])

min_pressure=train.groupby('breath_id')['pressure'].min().to_frame().reset_index().rename({'pressure':'min_breath_pressure'}, axis=1)
sns.distplot(min_pressure['min_breath_pressure'])

skew_pressure=train.groupby('breath_id')['pressure'].skew().to_frame().reset_index().rename({'pressure':'skew_breath_pressure'}, axis=1)
sns.distplot(skew_pressure['skew_breath_pressure'])

sns.distplot(train['time_step'])

sns.set(style="white")
corr = train.drop(['id','breath_id'], axis=1).corr()
mask = np.triu(np.ones_like(corr, dtype=np.bool))
f, ax = plt.subplots(figsize=(10, 8))
cmap = sns.diverging_palette(220, 10, as_cmap=True)
plt.title('Correlation Matrix', fontsize=18)
sns.heatmap(corr, mask=mask, cmap=cmap, vmax=.3, center=0,
            square=True, linewidths=.5, cbar_kws={"shrink": .5}, annot=True)
plt.show()